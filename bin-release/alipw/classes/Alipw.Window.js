Alipw.Window=Alipw.extend(Alipw.Panel,{subCls:"alipw-window",modal:false,modalOverlayOpacity:0.3,closable:true,maximizable:false,minimizable:false,initPosition:null,draggable:true,resizable:true,floating:true,position:"fixed",showShadow:true,autoCenter:false,animated:false,taskbar:null,constructor:function(){Alipw.Window.superclass.constructor.apply(this,arguments)},commitProperties:function(){Alipw.Window.superclass.commitProperties.apply(this,arguments);if(this.draggable===true){this.draggable={useProxy:false}}},initialize:function(){Alipw.Window.superclass.initialize.apply(this,arguments);Alipw.WindowManager.register(this)},createDom:function(){Alipw.Window.superclass.createDom.apply(this,arguments);this.animationProxy=new Alipw.AnimationProxy();Alipw.getBody().append(this.animationProxy);this.addEventListener("destroy",function(a){this.animationProxy.remove();this.animationProxy=null},this);this.addEventListener("creationComplete",this.completeHandler_Window,this);this.addEventListener("dragend",this.dragEndHandler_Window,this);this.addEventListener("drag",this.dragHandler_Window,this)},renderComplete:function(){Alipw.Window.superclass.renderComplete.apply(this,arguments);if(this.draggable){var b=typeof(this.draggable)=="object"?this.draggable:{};this.draggable=jQuery.extend({dragEl:this.getDragEl_Window()},b)}if(this.modal){if(!this.modalOverlay){this.modalOverlay=new Alipw.ScreenMask({floatingManagement:false,opacity:this.modalOverlayOpacity});this.addEventListener("destroy",function(){if(this.modalOverlay){this.modalOverlay.destroy();this.modalOverlay=null}},this);this.modalOverlay.setPosition(null,null,this.zIndex-2)}this.modalOverlay.show()}else{if(this.modalOverlay){this.modalOverlay.setVisible(false)}}if(this.taskbar){if(typeof(this.taskbar)=="string"){this.taskbar=Alipw.getComp(this.taskbar)}if(this.taskbar instanceof Alipw.Taskbar){var a=this.taskbar.addItem(this);a.activate();this.addEventListener("destroy",function(){this.taskbar.removeItem(this)},this)}}this.addEventListener("visibilityChange",this.visibilityChangeHandler_Window,this);this.addEventListener("move",this.moveHandler_Window,this)},destroy:function(){Alipw.WindowManager.unregister(this);Alipw.Window.superclass.destroy.apply(this,arguments)},renderHeaderBtns:function(){if(this.minimizable&&this.taskbar){if(!this.minimizeBtn){this.minimizeBtn=new Alipw.Button({label:"",cls:"button-alipw-panel-header-grey alipw-panel-btn-min",width:30,height:22,inlineStyle:{"margin-right":"-1px"},iconCls:"icon-alipw-panel-minimizeBtn",renderTo:this.el.find("."+this.baseCls+"-header-buttons"),handler:this.minimizeHandler_Window,scope:this});if(this.closeBtn){this.el.find("."+this.baseCls+"-header-buttons").append(this.closeBtn.el)}}}if(this.maximizable){if(!this.maximizeBtn){this.maximizeBtn=new Alipw.Button({label:"",cls:"button-alipw-panel-header-grey alipw-panel-btn-max",width:30,height:22,inlineStyle:{"margin-right":"-1px"},iconCls:"icon-alipw-panel-maximizeBtn",renderTo:this.el.find("."+this.baseCls+"-header-buttons"),handler:this.maximizeRestoreHandler_Window,scope:this});if(this.closeBtn){this.el.find("."+this.baseCls+"-header-buttons").append(this.closeBtn.el)}this.header.bind("dblclick",jQuery.proxy(this.maximizeRestoreHandler_Window,this))}}Alipw.Window.superclass.renderHeaderBtns.apply(this,arguments)},center:function(){var d=jQuery(window);var b=this.getWidth();var c=this.getHeight();var a=parseInt((d.width()-b)/2);var e=parseInt((d.height()-c)/2);if(a<10){a=10}if(e<10){e=10}if(this.position=="fixed"){this.setPosition(a,e)}else{this.setPosition(a+d.scrollLeft(),e+d.scrollTop())}},minimize:function(a){if(a){this.animationProxy.animate(this,this.taskbar.getBarItemByWindow(this),0.3,0.1,300)}this.remove();this.taskbar.getBarItemByWindow(this).deactivate();this.minimized=true},maximize:function(){this._storage_for_restore=[this.getX(),this.getY(),this.width,this.height];this.maximized=true;this.maximizeBtn.el.removeClass("alipw-panel-btn-max");this.maximizeBtn.el.addClass("alipw-panel-btn-restore");this.maximizeBtn.setIconCls("icon-alipw-panel-restoreBtn");if(this.shadow){this.shadow.disable()}if(this.dragSupporter){this.dragSupporter.disable()}this.setPosition(0,0);this.setWidth(jQuery(window).width());this.setHeight(jQuery(window).height());if(this.resizeSupporter){this.resizeSupporter.disable()}},restore:function(a){if(this.minimized){this.minimized=false;this.render();if(a){this.setVisible(false,true);var b=this;this.animationProxy.animate(this.taskbar.getBarItemByWindow(this),this,0.3,0.1,300,function(){b.setVisible(true)})}else{this.setVisible(true)}}else{if(this.maximized){this.maximized=false;this.maximizeBtn.el.removeClass("alipw-panel-btn-restore");this.maximizeBtn.el.addClass("alipw-panel-btn-max");this.maximizeBtn.setIconCls("icon-alipw-panel-maximizeBtn");if(this.shadow){this.shadow.enable()}if(this.dragSupporter){this.dragSupporter.enable()}this.setPosition(this._storage_for_restore[0],this._storage_for_restore[1]);this.setWidth(this._storage_for_restore[2]);this.setHeight(this._storage_for_restore[3]);if(this.resizeSupporter){this.resizeSupporter.enable()}}}},maximizeRestoreHandler_Window:function(){if(this.maximized){this.restore(this.animated)}else{this.maximize(this.animated)}},minimizeHandler_Window:function(){this.minimize(this.animated)},completeHandler_Window:function(){if(!this.initPosition){this.center()}else{if(this.initPosition instanceof Array){this.setPosition(this.initPosition[0],this.initPosition[1])}}this.addEventListener("mousedown",this.mouseDownHandler_Window,this,true);var a=Alipw.createFuncProxy(this.resizeHandler_Window,this);jQuery(window).bind("resize",a);this.addEventListener("destroy",function(){jQuery(window).unbind("resize",a)},this)},visibilityChangeHandler_Window:function(a){if(this.modalOverlay){this.modalOverlay.setVisible(this.visible)}},moveHandler_Window:function(){if(this.modalOverlay){this.modalOverlay.setPosition(null,null,this.zIndex-2)}},resizeHandler_Window:function(){if(this.maximized){this.setWidth(jQuery(window).width());this.setHeight(jQuery(window).height())}if(!this.maximized&&this.autoCenter){var a=this;clearTimeout(this.centerTimer);this.centerTimer=setTimeout(function(){a.center()},10)}},mouseDownHandler_Window:function(b,a){Alipw.ComponentManager.bringToFront(this)},dragEndHandler_Window:function(b,a){this.setPosition(a.left,a.top)},dragHandler_Window:function(b,a){},getDragEl_Window:function(){if(this.showHeader&&this.header){return this.header}else{if(!this.showHeader&&this.body){return this.body}}}});