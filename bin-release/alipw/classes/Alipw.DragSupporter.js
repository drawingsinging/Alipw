Alipw.DragSupporter=Alipw.extend(Alipw.Nonvisual,{target:"",dragEl:"",useProxy:true,draggable:true,droppable:false,draggingCls:"alipw-component-dragging",enabled:true,constructor:function(){Alipw.DragSupporter.superclass.constructor.apply(this,arguments)},commitProperties:function(){Alipw.DragSupporter.superclass.commitProperties.apply(this,arguments);if(this.target instanceof Alipw.Component){this.targetEl=this.target.el}else{this.targetEl=Alipw.convertEl(this.target)}},initialize:function(){Alipw.DragSupporter.superclass.initialize.apply(this,arguments);if(this.targetEl[0]){var a=this.dragEl?jQuery(this.dragEl):this.targetEl;a.bind("mousedown",jQuery.proxy(this.getReady,this));jQuery(document).bind("mousemove",jQuery.proxy(this.move,this));jQuery(document).bind("mouseup",jQuery.proxy(this.release,this))}},getReady:function(a){if(!this.enabled){return}a.preventDefault();this.ready=true;this._dx=this.targetEl.offset().left-a.pageX;this._dy=this.targetEl.offset().top-a.pageY},move:function(a){if(!this.enabled||!this.ready){return}a.preventDefault();if(!this.dragging){this.dragging=true;if(this.useProxy){if(!this.proxy){this.proxy=new Alipw.BorderContainer({cls:"alipw-dragproxy",floating:true,position:(this.target instanceof Alipw.Component)?this.target.position:""});this.addEventListener("destroy",function(){if(this.proxy){this.proxy.destroy();this.proxy=null}},this)}this.proxy.show();this.proxy.setWidth(this.targetEl.width());this.proxy.setHeight(this.targetEl.height());Alipw.ComponentManager.bringToFront(this.proxy)}else{if(this.draggingCls){this.targetEl.addClass(this.draggingCls)}}if(this.target instanceof Alipw.Component){this.originalPosition=[this.target.getX(),this.target.getY()];this.target.fireEvent("dragstart",{},false)}else{this.originalPosition=[this.targetEl.offset().left,this.targetEl.offset().top];this.targetEl.triggerHandler("alipw-dragstart")}}if(this.target instanceof Alipw.Component){if(this.target.position=="fixed"){this._currCoord=this.getHandledPosition_DragSupporter(a.clientX+this._dx,a.clientY+this._dy);(this.proxy||this.target).setPosition(this._currCoord[0],this._currCoord[1],null,false)}else{this._currCoord=this.getHandledPosition_DragSupporter(a.pageX+this._dx,a.pageY+this._dy);(this.proxy||this.target).el.offset({left:this._currCoord[0],top:this._currCoord[1]})}this.target.fireEvent("drag",{left:this._currCoord[0],top:this._currCoord[1]},false)}else{this._currCoord=this.getHandledPosition_DragSupporter(a.pageX+this._dx,a.pageY+this._dy);if(this.proxy){this.proxy.el.offset({left:this._currCoord[0],top:this._currCoord[1]})}else{this.targetEl.offset({left:this._currCoord[0],top:this._currCoord[1]})}this.targetEl.triggerHandler("alipw-drag",{left:this._currCoord[0],top:this._currCoord[1]})}},release:function(a){if(!this.enabled){return}if(this.dragging){this.dragging=false;if(this.target instanceof Alipw.Component){this.target.setPosition(this.originalPosition[0],this.originalPosition[1],null,false);this.target.fireEvent("dragend",{left:this._currCoord[0],top:this._currCoord[1]},false)}else{this.targetEl.offset({left:this.originalPosition[0],top:this.originalPosition[1]});this.targetEl.triggerHandler("alipw-dragend",{left:this._currCoord[0],top:this._currCoord[1]})}}if(this.draggingCls){this.targetEl.removeClass(this.draggingCls)}if(this.proxy){this.proxy.setVisible(false)}this.dragging=false;this.ready=false},getHandledPosition_DragSupporter:function(b,h){var j=jQuery(window);var c=j.width();var d=j.height();var f=Alipw.getDocWidth();var k=Alipw.getDocHeight();var i,e;i=this.targetEl.outerWidth();e=this.targetEl.outerHeight();if(this.target.position=="fixed"){if(b+i>c-10){b=c-i-10}if(b<10){b=10}if(h+e>d-10){h=d-e-10}if(h<10){h=10}}else{var a=c>f?c:f;var g=d>k?d:k;if(b+i>a-10){b=a-i-10}if(b<10){b=10}if(h+e>g-10){h=g-e-10}if(h<10){h=10}}return[b,h]}});