Alipw.Pagination=Alipw.extend(Alipw.Component,{baseCls:"alipw-pagination",total:0,pageSize:20,pageTotal:0,pageItemTemplate:'<a href="#">{$pageText}</a>',totalInfoTemplate:"共{$total}条记录",currentPage:1,maxSiblingItemNum:10,prevText:"上一页",nextText:"下一页",jumpText:"跳转",showTotalInfo:false,allowPageJump:false,constructor:function(a){Alipw.Pagination.superclass.constructor.apply(this,arguments)},commitProperties:function(){Alipw.Pagination.superclass.commitProperties.apply(this,arguments);this.total=parseInt(this.total);this.pageSize=parseInt(this.pageSize);if(!this.total||this.total<0){this.total=0}if(!this.pageSize||this.pageSize<0){this.pageSize=0}},initialize:function(){Alipw.Pagination.superclass.initialize.apply(this,arguments)},createDom:function(){Alipw.Pagination.superclass.createDom.apply(this,arguments)},render:function(a){Alipw.Pagination.superclass.render.apply(this,arguments)},renderComplete:function(a){Alipw.Pagination.superclass.renderComplete.apply(this,arguments);this.createPageItems_Pagination();this.setCurrentPage(this.currentPage);this.addEventListener("click",this.pageItemClickHandler_Pagination,this,true);this.addEventListener("mouseover",this.pageItemMouseOverHandler_Pagination,this,true);this.addEventListener("mouseout",this.pageItemMouseOutHandler_Pagination,this,true)},setCurrentPage:function(b,a){if(b>this.pageTotal){b=this.pageTotal}if(typeof(b)!="number"||b<=0){b=1}var d=b!=this.currentPage;var c=this.currentPage;this.currentPage=b;this.renderPageItems_Pagination();if(b>0){if(c>0&&this.pageItems[c-1]){this.pageItems[c-1].removeClass(this.baseCls+"-current")}if(this.pageItems[b-1]){this.pageItems[b-1].addClass(this.baseCls+"-current")}}if(d){this.fireEvent("pageChange",{},false);if(a){this.fireEvent("change",{},false)}}},getPageTotal:function(){if(this.total==0||this.pageSize==0){return 0}this.pageTotal=parseInt(this.total/this.pageSize)+(this.total%this.pageSize>0?1:0);return this.pageTotal},updatePage:function(a){this.getPageTotal();this.renderPageItems_Pagination();if(this.pageTotal==0){this.setCurrentPage(0)}else{if(this.currentPage>this.pageTotal){this.setCurrentPage(this.pageTotal)}}},_doLayout:function(){Alipw.BoxComponent.superclass._doLayout.apply(this,arguments)},createPageItems_Pagination:function(){var a=this.getPageTotal();if(a==0){this.currentPage=0}else{if(this.currentPage>a||this.currentPage==0){this.currentPage=1}}this.pageItems=new Array();this.leftEllipsis=jQuery('<span class="'+this.baseCls+'-ellipsis">…</span>');this.rightEllipsis=jQuery('<span class="'+this.baseCls+'-ellipsis">…</span>');this.prevBtn=new Alipw.Template(this.pageItemTemplate).set({pageText:this.prevText}).compile();this.prevBtn.addClass(this.baseCls+"-prev");this.nextBtn=new Alipw.Template(this.pageItemTemplate).set({pageText:this.nextText}).compile();this.nextBtn.addClass(this.baseCls+"-next");this.jumpBtn=new Alipw.Template(this.pageItemTemplate).set({pageText:this.jumpText}).compile();this.jumpBtn.addClass(this.baseCls+"-jump");this.jumpInputBox=jQuery('<input type="text" class="'+this.baseCls+'-jump-input"/>');this.jumpInputBox.bind("keypress",jQuery.proxy(function(d){if(d.keyCode==13&&Alipw.isNumeric(this.jumpInputBox.val())){this.setCurrentPage(parseInt(this.jumpInputBox.val()),true);return}var c;if(Alipw.isIE){c=d.keyCode}else{c=d.charCode}if((c<48||c>57)&&c!=0){d.preventDefault()}},this));var b=jQuery.proxy(function(c){value=this.jumpInputBox.val();if(!Alipw.isNumeric(value)){this.jumpInputBox.val("")}},this);this.jumpInputBox.bind("keyup keypress change",b);this.totalInfo=jQuery('<span class="'+this.baseCls+'-info"></span>');this.totalInfo.html(new Alipw.Template(this.totalInfoTemplate).set({total:this.total}).html)},renderPageItems_Pagination:function(){this.totalInfo.html(new Alipw.Template(this.totalInfoTemplate).set({total:this.total}).html);for(var c in this.pageItems){if(Alipw.isIntegral(c)){this.pageItems[c].detach();this.pageItems[c].removeClass(this.baseCls+"-hover")}}if(this.total<=0){if(this.currentPage>0&&this.pageItems[this.currentPage-1]){this.pageItems[this.currentPage-1].removeClass(this.baseCls+"-current")}this.leftEllipsis.detach();this.rightEllipsis.detach();this.prevBtn.detach();this.nextBtn.detach();this.jumpBtn.detach();this.jumpInputBox.detach();if(this.showTotalInfo){this.el.append(this.totalInfo)}return}if(this.currentPage<=0){return}var b=this.getDisplayedItemsIndex_Pagination();var e,a;if(b){e=b[0];a=b[1]}else{e=0;a=this.pageTotal-1}for(var c=e;c<=a;c++){this.el.append(this.getPageItem_Pagination(c))}this.prevBtn.removeClass(this.baseCls+"-hover");this.nextBtn.removeClass(this.baseCls+"-hover");this.jumpBtn.removeClass(this.baseCls+"-hover");var d=false;if(b&&b[0]!=0){if(b[0]>1){this.el.prepend(this.leftEllipsis);d=true}else{this.leftEllipsis.detach()}this.el.prepend(this.getPageItem_Pagination(0))}else{this.leftEllipsis.detach()}if(b&&b[1]<this.pageTotal-1){if(b[1]<this.pageTotal-2){this.el.append(this.rightEllipsis);d=true}else{this.rightEllipsis.detach()}this.el.append(this.getPageItem_Pagination(this.pageTotal-1))}else{this.rightEllipsis.detach()}if(this.currentPage!=1&&this.pageTotal>0){this.el.prepend(this.prevBtn)}else{this.prevBtn.detach()}if(this.currentPage!=this.pageTotal){this.el.append(this.nextBtn)}else{this.nextBtn.detach()}if(this.showTotalInfo){this.el.prepend(this.totalInfo)}if(this.allowPageJump&&d){this.el.append(this.jumpInputBox);this.el.append(this.jumpBtn)}else{this.jumpInputBox.detach();this.jumpBtn.detach()}},pageItemClickHandler_Pagination:function(c){c.preventDefault();var b=this.getPageItemIndexByTarget_Pagination(c.target);if(b>-1){this.setCurrentPage(b+1,true)}else{if(b==-100){if(this.currentPage>1){this.setCurrentPage(this.currentPage-1,true)}}else{if(b==-101){if(this.currentPage<this.pageTotal){this.setCurrentPage(this.currentPage+1,true)}}else{if(b==-102){var a=this.jumpInputBox.val();if(Alipw.isNumeric(a)){this.setCurrentPage(parseInt(a),true)}}}}}},pageItemMouseOverHandler_Pagination:function(b){var a=this.getPageItemIndexByTarget_Pagination(b.target);if(a>-1){this.pageItems[a].addClass(this.baseCls+"-hover")}else{if(a==-100){this.prevBtn.addClass(this.baseCls+"-hover")}else{if(a==-101){this.nextBtn.addClass(this.baseCls+"-hover")}else{if(a==-102){this.jumpBtn.addClass(this.baseCls+"-hover")}}}}},pageItemMouseOutHandler_Pagination:function(b){var a=this.getPageItemIndexByTarget_Pagination(b.target);if(a>-1){this.pageItems[a].removeClass(this.baseCls+"-hover")}else{if(a==-100){this.prevBtn.removeClass(this.baseCls+"-hover")}else{if(a==-101){this.nextBtn.removeClass(this.baseCls+"-hover")}else{if(a==-102){this.jumpBtn.removeClass(this.baseCls+"-hover")}}}}},getPageItemIndexByTarget_Pagination:function(b){var a=-1;if(b==this.prevBtn[0]){a=-100}else{if(b==this.nextBtn[0]){a=-101}else{if(b==this.jumpBtn[0]){a=-102}else{if(b.id.indexOf(this.id+"-index-")==0){a=parseInt(b.id.split(this.id+"-index-")[1])}}}}if(b==this.el[0]){return -1}else{if(a==-1){return this.getPageItemIndexByTarget_Pagination(b.parentNode)}else{return a}}},getDisplayedItemsIndex_Pagination:function(){if(this.pageTotal<=this.maxSiblingItemNum||this.currentPage==0){return null}var b=this.currentPage-1;var e,c;if(this.maxSiblingItemNum%2==0){e=c=this.maxSiblingItemNum/2}else{e=parseInt(this.maxSiblingItemNum/2);c=this.maxSiblingItemNum-e}if(b-e<0){e=b;c=this.maxSiblingItemNum-e}else{if(b+c>this.pageTotal-1){c=this.pageTotal-1-b;e=this.maxSiblingItemNum-c}}var a=b-e;var d=b+c;return[a,d]},getPageItem_Pagination:function(a){if(this.pageItems&&!this.pageItems[a]){this.pageItems[a]=new Alipw.Template(this.pageItemTemplate).set({pageText:a+1}).compile();this.pageItems[a].attr("id",this.id+"-index-"+a)}return this.pageItems[a]}});