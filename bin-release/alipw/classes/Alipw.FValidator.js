(function(){Alipw.FValidator=Alipw.extend(Alipw.Nonvisual,{commitProperties:function(g){Alipw.FValidator.superclass.commitProperties.apply(this,arguments);var h={items:[{item:null,tip:null,require:true,rule:null,ajax:null,msg:null}],rules:{},tipcls:{normal:"alipw-tip-normal",empty:"alipw-tip-empty",right:"alipw-tip-right",error:"alipw-tip-error",ajaxError:"alipw-tip-ajaxError",pending:"alipw-tip-pending"},msg:{normal:"请输入",empty:"此项不能空",right:"",error:"格式不正确",ajaxError:"服务器校验未通过",pending:"校验中..."},autoTrim:true,noRepeat:false};g=$.extend(true,h,g||{});b.call(this,g);this.ajaxCheckStatus={};this.result=true;this.count=0;this.ico={}},initialize:function(){Alipw.FValidator.superclass.initialize.apply(this,arguments);this.add(this.items)},add:function(h){var k=this,g=c(h)=="Array"?h:[h];for(var n=0,j=g.length;n<j;n++){var m=$(g[n].item);if(!m.length){continue}var h=this._configItem(g[n]);m.bind("focus blur",function(i){return function(l){l.type=="focus"?f(i,"normal"):k.check(i.item)}}(h));this.count++}return this},remove:function(m){var h=c(m)=="Array"?m:[m];for(var k=0,j=h.length;k<j;k++){$(h[k]).unbind("focus blur");var g=this._getItemVidentifier(h[k]);if(this.ico[g]&&this.ico[g].tip$){this.ico[g].tip$.remove();delete this.ico[g];this.count--}}return this},modify:function(h){delete h.result;var g=this._getItemVidentifier(h.item);h=$.extend(true,this.ico[g],h);this._configItem(h);h.noRepeat&&this.ico[g]&&(this.ico[g].$isChked=false);this.check(this.ico[g].item);return this},search:function(g){return $.extend(true,{},this.ico[this._getItemVidentifier(g)])},getResult:function(){return this.checkAll()},v2c:function(j,i){var h=this;this.checkAll();if(d(this.ajaxCheckStatus)){var g=setInterval(function(){if(d(h.ajaxCheckStatus)){return}clearInterval(g);i?j(h.result):(h.result&&j(h.result))},10)}else{i?j(h.result):(h.result&&j(h.result))}},check:function(n,m){var i=this._getItemVidentifier(n),h=this.ico[i],l=h.autoTrim?$.trim($(h.item).val()):$(h.item).val(),k=this,g;if(h.noRepeat){g=h.$oldValue===l&&h.$isChked?h.result:function(o){return e(h,o)}(this);h.$oldValue=l;h.$isChked=true}else{g=function(o){return e(h,o)}(this)}f(h,g,true);if(g=="pending"&&m){if(this.ajaxCheckStatus[i]){var j=setInterval(function(){if(k.ajaxCheckStatus[i]){return}clearInterval(j);m($.inArray(h.result,["right","normal"])<0?false:true)},10)}else{m($.inArray(h.result,["right","normal"])<0?false:true)}}g=$.inArray(g,["right","normal","pending"])<0?false:g=="pending"?"pending":true;return g},checkAll:function(i){this.result=true;for(var h in this.ico){var g=this.check(this.ico[h].item);if(i){switch(this.result){case true:this.result=g;break;case"pending":g===false&&(this.result=false);break}}else{this.result!==false&&(!g||g==="pending")&&(this.result=false)}}return this.result},_configItem:function(g){var g=$.extend(true,{},g);if($.inArray(c(g.rule),["String","Array"])>-1){if(c(g.rule)=="Array"){for(var i=0,h=g.rule.length;i<h;i++){c(g.rule[i])=="String"&&(g.rule[i]=this.rules[g.rule[i]])}}else{g.rule=this.rules[g.rule]}}g.require=g.require!==undefined?g.require:true;g.result=g.require?"empty":"normal";g.tipcls=$.extend(true,{},this.tipcls,g.tipcls||{});g.msg=$.extend(true,{},this.msg,g.msg||{});g.tip$=g.tip?$(g.tip):$('<span class="'+g.tipcls.normal+'"></span>').insertAfter(g.item);g.autoTrim=g.autoTrim===undefined?this.autoTrim:g.autoTrim;g.noRepeat=g.noRepeat===undefined?this.noRepeat:g.noRepeat;if(this.ico[this._getItemVidentifier(g.item)]){$.extend(true,this.ico[this._getItemVidentifier(g.item)]||{},g)}else{this.ico[this._getItemVidentifier(g.item)]=g}return g},_getItemVidentifier:function(h){var g=$(h),i=g.attr("_videntifier");if(!i){i=new Date().getTime()+"_"+this.count;g.attr("_videntifier",i)}return i}});function a(g){return document.createElement(g)}function b(g){for(var h in g){this[h]=g[h]}}function e(g,k){var q=g.autoTrim?$.trim($(g.item).val()):$(g.item).val(),o=g.rule,p=g.ajax,r;g.autoTrim&&$(g.item).val(q);if(q!==""){var n=c(o);switch(n){case"RegExp":r=o.test(q)?"right":"error";break;case"Function":r=o(q)?"right":"error";break;case"Array":var j=$.extend({},g);for(var m=0,h=o.length;m<h;m++){j.rule=o[m];j.ajax=null;if((r=e(j,k))=="error"){break}}break;default:r="right"}if(r=="right"&&p&&!k.ajaxCheckStatus[k._getItemVidentifier(g.item)]){r=g.result="pending";k.ajaxCheckStatus[k._getItemVidentifier(g.item)]=1;p(q,function(i,s){r=Boolean(i)?"right":"ajaxError";g.result=r;g.msg[r]=s||g.msg[r];if(r=="right"){k.result=true;for(var l in k.ico){if($.inArray(k.ico[l].result,["right","normal"])<0){k.result=false;break}}}else{k.result=false}f(g,r,true);delete k.ajaxCheckStatus[k._getItemVidentifier(g.item)]})}g.result=="pending"&&(r="pending");g.result=r}else{r=g.require?"empty":"normal";g.result=r}return r}function f(h,g,m){var i=h.tip$,k=i[0].$history_result;if(!h.require||k!=g){var j=h.tipcls[k],l=h.tipcls[g];i.removeClass(j).addClass(l).text(h.msg[g]||"");!h.require&&m&&g=="normal"?i.hide():i.show();i[0].$history_result=g}}function c(h){if(h&&h.constructor&&h.constructor.toString){var g=h.constructor.toString(),i=/^[\s\(]*function\s+(.+)\(/.exec(g);return i&&i[1]||"undefined"}return"undefined"}function d(i){var g=0;for(var h in i){g++}return g}Alipw.V=Alipw.FValidator})();